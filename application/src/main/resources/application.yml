spring:
  application:
    name: hexagonal
  datasource:
    url: jdbc:postgresql://localhost:5432/hexagonal_db
    username: user
    password: pass
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: none
    open-in-view: false
    properties:
      hibernate.jdbc.time_zone: UTC
  liquibase:
    enabled: true
    change-log: classpath:db/changelog.xml
    contexts: seed

kafka:
  bootstrap-servers: localhost:9093
  schema-registry-url: http://localhost:8081

logging:
  level:
    org.hibernate.SQL: warn

garage:
  admin:
    host: localhost
    port: 3903
    secure: false
    token: ${GARAGE_ADMIN_TOKEN:admin-token-change-me}

s3:
  endpoint: localhost
  port: 3900
  secure: false
  access-key: ${S3_ACCESS_KEY:}
  secret-key: ${S3_SECRET_KEY:}
  region: garage

streams:
  inputs:
    - payload-type: com.bullit.domain.event.SaleEvent
      topic: raw-sales
      group-id: sale-to-royalty
    - payload-type: com.bullit.domain.event.RoyaltyReportEvent
      topic: author-royalties
      group-id: royalty-report-to-s3
  outputs:
    - payload-type: com.bullit.domain.event.SaleEvent
      topic: raw-sales
      key: com.bullit.core.usecase.SaleEventKey
    - payload-type: com.bullit.domain.event.RoyaltyReportEvent
      topic: author-royalties
  handlers:
    - handler-class: com.bullit.core.usecase.SaleToRoyaltyHandler
    - handler-class: com.bullit.core.usecase.RoyaltyReportToS3FileHandler

files:
  inputs:
    - payload-type: com.bullit.domain.model.royalty.Sale
      bucket: raw-sales
      incoming-prefix: incoming
      handled-prefix: handled
      error-prefix: error
      poll-interval: 1s

  outputs:
    - payload-type: com.bullit.domain.event.RoyaltyReportEvent
      bucket: royalty-reports

  handlers:
    - handler-class: com.bullit.core.usecase.SaleFileToKafkaHandler
